<div class="dnnDevTools-hostSettings">
    <div class="dnnDevTools-panel dnnDevTools-bgColorDnnBlue">
        <div class="dnnDevTools-checkbox">
            <input type="checkbox" id="dnnDevTools-enableCheckbox">
            <label for="dnnDevTools-enableCheckbox" class="dnnDevTools-copy dnnDevTools-colorWhite">Enable DNN Dev Tools</label>
        </div>
    </div>

    <div class="dnnDevTools-panel dnnDevTools-bgColorWhite dnnDevTools-marginTop2">
        <h2 class="dnnDevTools-headline">Mail Catch</h2>
        <div class="dnnDevTools-checkbox">
            <input type="checkbox" id="dnnDevTools-enableMailCatchCheckbox">
            <label for="dnnDevTools-enableMailCatchCheckbox" class="dnnDevTools-copy">Enable mail catch</label>
        </div>
        <div class="dnnDevTools-marginTop2">
            <button type="button" id="dnnDevTools-sendMailButton" class="dnnDevTools-sendMailButton dnnDevTools-button">Send test mail</button>
            <p class="dnnDevTools-smtpError dnnDevTools-copy dnnDevTools-hidden">SMTP not properly configured. Please check your SMTP settings.</p>
        </div>
    </div>

    <div class="dnnDevTools-panel dnnDevTools-bgColorWhite dnnDevTools-marginTop2">
        <h2 class="dnnDevTools-headline">DNN Event tracing</h2>
        <div class="dnnDevTools-checkbox">
            <input type="checkbox" id="dnnDevTools-enableDnnEventTraceCheckbox">
            <label for="dnnDevTools-enableDnnEventTraceCheckbox" class="dnnDevTools-copy">Enable trace</label>
        </div>
    </div>

    <div class="dnnDevTools-panel dnnDevTools-bgColorWhite dnnDevTools-marginTop2">
        <h2 class="dnnDevTools-headline">Log message tracing</h2>
        <div class="dnnDevTools-checkbox">
            <input type="checkbox" id="dnnDevTools-enableLoggingCheckbox">
            <label for="dnnDevTools-enableLoggingCheckbox" class="dnnDevTools-copy">Enable trace</label>
        </div>
        <div class="dnnDevTools-marginTop2">
            <label for="dnnDevTools-logLevelSelect" class="dnnDevTools-copy dnnDevTools-displayBlock">Select log level</label>
            <select name="" id="dnnDevTools-logLevelSelect" class="dnnDevTools-select dnnDevTools-marginTop1">
                <option value="ALL">all</option>
                <option value="DEBUG">debug</option>
                <option value="INFO">info</option>
                <option value="WARN">warning</option>
                <option value="ERROR">error</option>
                <option value="FATAL">fatal</option>
            </select>
        </div>
    </div>
</div>

<script>
    (function () {
        var enableCheckbox = document.getElementById('dnnDevTools-enableCheckbox'),
            enableMailCatchCheckbox = document.getElementById('dnnDevTools-enableMailCatchCheckbox'),
            enableDnnEventTraceCheckbox = document.getElementById('dnnDevTools-enableDnnEventTraceCheckbox'),
            enableLoggingCheckbox = document.getElementById('dnnDevTools-enableLoggingCheckbox'),
            logLevelSelect = document.getElementById('dnnDevTools-logLevelSelect'),
            sendMailButton = document.getElementById('dnnDevTools-sendMailButton');

        // set current status
        enableCheckbox.checked = window.weweave.dnnDevTools.enable;
        enableMailCatchCheckbox.checked = window.weweave.dnnDevTools.enableMailCatch;
        enableDnnEventTraceCheckbox.checked = window.weweave.dnnDevTools.enableDnnEventTrace;
        enableLoggingCheckbox.checked = window.weweave.dnnDevTools.logMessageTraceLevel !== 'OFF';

        // enable send test mail functionality if smtp is configured properly
        // otherwise disable send test mail button
        if (window.weweave.dnnDevTools.hostSmtpConfigured) {
            sendMailButton.addEventListener('click', function () {
                sendMail();
            }, false);
        } else {
            sendMailButton.setAttribute('disabled', 'disabled');
        }

        enableCheckbox.addEventListener('change', function (event) {
            setStatus(enableCheckbox.checked);
        }, false);

        enableMailCatchCheckbox.addEventListener('change', function (event) {
            setMailCatchStatus(enableMailCatchCheckbox.checked);
        }, false);

        enableDnnEventTraceCheckbox.addEventListener('click', function () {
            setEventTraceStatus(enableDnnEventTraceCheckbox.checked);
        }, false);

        enableLoggingCheckbox.addEventListener('click', function () {
            setLoggingStatus(enableLoggingCheckbox.checked);
        }, false);

        logLevelSelect.addEventListener('change', function () {
            setLogLevel(logLevelSelect.value);
        });

        function setStatus(isEnabled) {
            dnnDevTools.ajax('PUT', window.weweave.dnnDevTools.baseUrl + 'api/config/enable?status=' + isEnabled).then(
                function (response) {
                    window.location.reload(false);
                }, function (error) {
                    // TODO show error
                }
            );
        }

        function setMailCatchStatus(isEnabled) {
            dnnDevTools.ajax('PUT', window.weweave.dnnDevTools.baseUrl + 'api/config/enableMailCatch?status=' + isEnabled).then(
                function (response) {
                    console.log(response);
                }, function (error) {
                    // TODO show error
                }
            );
        }

        function setEventTraceStatus(isEnabled) {
            dnnDevTools.ajax('PUT', window.weweave.dnnDevTools.baseUrl + 'api/config/enableDnnEventTrace?status=' + isEnabled).then(
                function (response) {
                    console.log(response);
                }, function (error) {
                    // TODO show error
                }
            );
        }

        function setLoggingStatus(isEnabled) {
            if (isEnabled) {
                setLogLevel(logLevelSelect.value);
            } else {
                setLogLevel('OFF');
            }
        }

        function sendMail() {
            dnnDevTools.ajax('POST', window.weweave.dnnDevTools.baseUrl + 'api/config/sendTestMail').then(
                function (response) {
                    console.log(response);
                }, function (error) {
                    // TODO show error
                }
            );
        }

        function setLogLevel(level) {
            dnnDevTools.ajax('PUT', window.weweave.dnnDevTools.baseUrl + 'api/config/setLogMessageTraceLevel?level=' + level).then(
                function (response) {
                    console.log(response);
                }, function (error) {
                    // TODO show error
                }
            );
        }
    }());
</script>